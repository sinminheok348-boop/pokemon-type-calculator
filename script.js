// 예시 포켓몬 데이터
const pokemonData = {
  "피카츄": { types: ["전기"], dps: 50 },
  "리자몽": { types: ["불꽃", "비행"], dps: 70 },
  "메가리자몽": { types: ["불꽃", "드래곤"], dps: 90 },
  "꼬부기": { types: ["물"], dps: 40 }
};

// 날씨별 부스트 타입
const weatherBoosts = {
  sunny: ["불꽃", "풀", "땅"],
  partlyCloudy: ["바위", "노말"],
  cloudy: ["격투", "독", "페어리"],
  rainy: ["물", "전기", "벌레"],
  snow: ["얼음", "강철"],
  windy: ["드래곤", "비행", "에스퍼"],
  fog: ["고스트", "악"]
};

// 타입 상성표 (방어 기준)
const typeChart = {
  "노말": {"노말":1,"불꽃":1,"물":1,"풀":1,"전기":1,"얼음":1,"격투":1.6,"독":1,"땅":1,"비행":1,"에스퍼":1,"벌레":1,"바위":0.625,"고스트":0.39,"드래곤":1,"악":1,"강철":0.625,"페어리":1},
  "불꽃": {"노말":1,"불꽃":0.625,"물":0.625,"풀":1.6,"전기":1,"얼음":1.6,"격투":1,"독":1,"땅":1,"비행":1,"에스퍼":1,"벌레":1.6,"바위":0.625,"고스트":1,"드래곤":0.625,"악":1,"강철":1.6,"페어리":1},
  "물": {"노말":1,"불꽃":1.6,"물":0.625,"풀":0.625,"전기":1,"얼음":1,"격투":1,"독":1,"땅":1.6,"비행":1,"에스퍼":1,"벌레":1,"바위":1.6,"고스트":1,"드래곤":0.625,"악":1,"강철":1,"페어리":1},
  "풀": {"노말":1,"불꽃":0.625,"물":1.6,"풀":0.625,"전기":1,"얼음":1,"격투":1,"독":0.625,"땅":1.6,"비행":0.625,"에스퍼":1,"벌레":0.625,"바위":1.6,"고스트":1,"드래곤":0.625,"악":1,"강철":0.625,"페어리":1},
  "전기": {"노말":1,"불꽃":1,"물":1.6,"풀":0.625,"전기":0.625,"얼음":1,"격투":1,"독":1,"땅":0.39,"비행":1.6,"에스퍼":1,"벌레":1,"바위":1,"고스트":1,"드래곤":0.625,"악":1,"강철":1,"페어리":1},
  "얼음": {"노말":1,"불꽃":0.625,"물":0.625,"풀":1.6,"전기":1,"얼음":0.625,"격투":1,"독":1,"땅":1.6,"비행":1.6,"에스퍼":1,"벌레":1,"바위":1,"고스트":1,"드래곤":1.6,"악":1,"강철":0.625,"페어리":1},
  "격투": {"노말":1.6,"불꽃":1,"물":1,"풀":1,"전기":1,"얼음":1.6,"격투":1,"독":0.625,"땅":1,"비행":0.625,"에스퍼":0.625,"벌레":0.625,"바위":1.6,"고스트":0.39,"드래곤":1,"악":1.6,"강철":1.6,"페어리":0.625},
  "독": {"노말":1,"불꽃":1,"물":1,"풀":1.6,"전기":1,"얼음":1,"격투":1,"독":0.625,"땅":0.625,"비행":1,"에스퍼":1,"벌레":1,"바위":0.625,"고스트":0.625,"드래곤":1,"악":1,"강철":0.39,"페어리":1.6},
  "땅": {"노말":1,"불꽃":1.6,"물":1,"풀":0.625,"전기":1.6,"얼음":1,"격투":1,"독":1.6,"땅":1,"비행":0.39,"에스퍼":1,"벌레":0.625,"바위":1.6,"고스트":1,"드래곤":1,"악":1,"강철":1.6,"페어리":1},
  "비행": {"노말":1,"불꽃":1,"물":1,"풀":1.6,"전기":0.625,"얼음":1,"격투":1.6,"독":1,"땅":1,"비행":1,"에스퍼":1,"벌레":1.6,"바위":0.625,"고스트":1,"드래곤":1,"악":1,"강철":0.625,"페어리":1},
  "에스퍼": {"노말":1,"불꽃":1,"물":1,"풀":1,"전기":1,"얼음":1,"격투":1.6,"독":1.6,"땅":1,"비행":1,"에스퍼":0.625,"벌레":1,"바위":1,"고스트":1,"드래곤":1,"악":0.39,"강철":0.625,"페어리":1},
  "벌레": {"노말":1,"불꽃":0.625,"물":1,"풀":1.6,"전기":1,"얼음":1,"격투":0.625,"독":0.625,"땅":1,"비행":0.625,"에스퍼":1.6,"벌레":1,"바위":1,"고스트":0.625,"드래곤":1,"악":1.6,"강철":0.625,"페어리":0.625},
  "바위": {"노말":1,"불꽃":1.6,"물":1,"풀":1,"전기":1,"얼음":1.6,"격투":0.625,"독":1,"땅":0.625,"비행":1.6,"에스퍼":1,"벌레":1.6,"바위":1,"고스트":1,"드래곤":1,"악":1,"강철":0.625,"페어리":1},
  "고스트": {"노말":0.39,"불꽃":1,"물":1,"풀":1,"전기":1,"얼음":1,"격투":1,"독":1,"땅":1,"비행":1,"에스퍼":1.6,"벌레":1,"바위":1,"고스트":1.6,"드래곤":1,"악":0.625,"강철":1,"페어리":1},
  "드래곤": {"노말":1,"불꽃":1,"물":1,"풀":1,"전기":1,"얼음":1,"격투":1,"독":1,"땅":1,"비행":1,"에스퍼":1,"벌레":1,"바위":1,"고스트":1,"드래곤":1.6,"악":1,"강철":0.625,"페어리":0.39},
  "악": {"노말":1,"불꽃":1,"물":1,"풀":1,"전기":1,"얼음":1,"격투":0.625,"독":1,"땅":1,"비행":1,"에스퍼":1.6,"벌레":1,"바위":1,"고스트":1.6,"드래곤":1,"악":0.625,"강철":1,"페어리":0.625},
  "강철": {"노말":1,"불꽃":0.625,"물":0.625,"풀":1,"전기":0.625,"얼음":1.6,"격투":1,"독":1,"땅":1,"비행":1,"에스퍼":1,"벌레":1,"바위":1.6,"고스트":1,"드래곤":1,"악":1,"강철":0.625,"페어리":1.6},
  "페어리": {"노말":1,"불꽃":0.625,"물":1,"풀":1,"전기":1,"얼음":1,"격투":1.6,"독":0.625,"땅":1,"비행":1,"에스퍼":1,"벌레":1,"바위":1,"고스트":1,"드래곤":1,"악":1.6,"강철":0.625,"페어리":1}
};

// 배율 색상
function getMultiplierColor(multiplier) {
  if (multiplier >= 2) return "#16a34a";
  if (multiplier > 1) return "#86efac";
  if (multiplier === 1) return "#ffffff";
  if (multiplier > 0.5) return "#fecaca";
  return "#b91c1c";
}

function calculate() {
  const name = document.getElementById("pokemonInput").value.trim();
  const mega = document.getElementById("megaSelect").value;
  const selectedWeather = document.getElementById("weatherSelect").value;

  let pokeKey = mega === "메가" ? "메가" + name : name;
  if (!pokemonData[pokeKey]) {
    alert("포켓몬을 찾을 수 없습니다.");
    return;
  }

  const types = pokemonData[pokeKey].types;
  const boostedTypes = weatherBoosts[selectedWeather] || [];

  let resultArr = [];

  for (let atkType in typeChart) {
    let multiplierBeforeWeather = 1;
    for (let defType of types) {
      if (typeChart[atkType] && typeChart[atkType][defType] !== undefined) {
        multiplierBeforeWeather *= typeChart[atkType][defType];
      }
    }

    if (multiplierBeforeWeather === 1) continue;

    // 날씨 부스트 적용
    let multiplier = multiplierBeforeWeather;
    if (boostedTypes.includes(atkType)) multiplier *= 1.2;

    resultArr.push({ type: atkType, multiplier });
  }

  resultArr.sort((a, b) => b.multiplier - a.multiplier);

  let html = "<h3>타입 상성표</h3><table><tr><th>타입</th><th>배수</th></tr>";
  resultArr.forEach(r => {
    const color = getMultiplierColor(r.multiplier);
    html += `<tr style="background-color:${color};"><td>${r.type}</td><td>${r.multiplier.toFixed(2)}</td></tr>`;
  });
  html += "</table>";

  let recommended = Object.entries(pokemonData)
    .filter(([key, data]) => types.some(t => data.types.includes(t)))
    .sort((a, b) => b[1].dps - a[1].dps)
    .slice(0, 20);

  html += "<h3>추천 포켓몬 (DPS 기준)</h3><ul>";
  recommended.forEach(([key, data]) => {
    html += `<li>${key}<span>DPS: ${data.dps}</span></li>`;
  });
  html += "</ul>";

  document.getElementById("result").innerHTML = html;
}
